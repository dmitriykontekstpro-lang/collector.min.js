# üìä –ú–∞—Ç—Ä–∏—Ü–∞ –¥–∞–Ω–Ω—ã—Ö: –ß—Ç–æ —Å–æ–±–∏—Ä–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç (v3)

–í –Ω–æ–≤–æ–π —Å—Ö–µ–º–µ (Single Table) –≤—Å–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–∞–∂–¥—É—é –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü—É `analytics` –≤ –∫–æ–ª–æ–Ω–∫—É `data` (JSONB), –ø–ª—é—Å –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–ª—è –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏.

---

## üë§ 1. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç —É–∑–Ω–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –≤–∏–∑–∏—Ç–µ –∏ —Å–∫–ª–µ–∏—Ç—å –µ–≥–æ –∏—Å—Ç–æ—Ä–∏—é.

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ–ª–µ –≤ –ë–î | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|:---|:---|:---|:---|
| **User ID** | `user_id` | –í–µ—á–Ω—ã–π —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID (—Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ localStorage) | `550e8400-e29b-41d4-a716-446655440000` |
| **Session ID** | `session_id` | ID —Ç–µ–∫—É—â–µ–≥–æ –≤–∏–∑–∏—Ç–∞ (—Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏) | `7c9e6679-7425-40de-944b-e07fc1f90ae7` |

---

## üì± 2. –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–Ω—è—Ç—å, —Å –∫–∞–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ —Å–∏–¥—è—Ç –∫–ª–∏–µ–Ω—Ç—ã.

| –ü–∞—Ä–∞–º–µ—Ç—Ä | JSON –ø—É—Ç—å (`data.`) | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|:---|:---|:---|:---|
| **–¢–∏–ø —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞** | `is_mobile` | –ú–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ –Ω–µ—Ç | `true` / `false` |
| **–û–° / –ë—Ä–∞—É–∑–µ—Ä** | `ua` | –ü–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ User Agent | `Mozilla/5.0 (iPhone; CPU iPhone OS...)` |
| **–≠–∫—Ä–∞–Ω** | `screen` | –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–∞ | `390x844` |
| **–Ø–∑—ã–∫** | `language` | –Ø–∑—ã–∫ –±—Ä–∞—É–∑–µ—Ä–∞ | `ru-RU` |
| **–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å** | `timezone` | –í—Ä–µ–º–µ–Ω–Ω–∞—è –∑–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | `Europe/Moscow` |

---

## üîó 3. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ —Ç—Ä–∞—Ñ–∏–∫–∞ (–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥)
–û—Ç–∫—É–¥–∞ –ø—Ä–∏—à–µ–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å. –ü–∞—Ä—Å–∏—Ç—Å—è –∏–∑ URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

| –ü–∞—Ä–∞–º–µ—Ç—Ä | JSON –ø—É—Ç—å (`data.`) | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|:---|:---|:---|:---|
| **–ò—Å—Ç–æ—á–Ω–∏–∫** | `utm_source` | –†–µ–∫–ª–∞–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ | `yandex`, `google`, `telegram` |
| **–¢–∏–ø —Ç—Ä–∞—Ñ–∏–∫–∞** | `utm_medium` | –¢–∏–ø (cpc, email, organic) | `cpc` |
| **–ö–∞–º–ø–∞–Ω–∏—è** | `utm_campaign` | –ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–º–ø–∞–Ω–∏–∏ | `summer_sale_2025` |
| **–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ** | `utm_term` | –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å | `–∫—É–ø–∏—Ç—å —Å–ª–æ–Ω–∞` |
| **–ö–æ–Ω—Ç–µ–Ω—Ç** | `utm_content` | –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è | `banner_red` |
| **Yandex Click ID** | `yclid` | ID –∫–ª–∏–∫–∞ –î–∏—Ä–µ–∫—Ç–∞ | `123456789` |
| **–†–µ—Ñ–µ—Ä—Ä–µ—Ä** | `referrer` | –ü—Ä–µ–¥—ã–¥—É—â–∏–π —Å–∞–π—Ç (–æ—Ç–∫—É–¥–∞ –∫–ª–∏–∫–Ω—É–ª) | `https://vk.com/` |
| **–°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞** | `entry_url` | –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –≤–∏–∑–∏—Ç–∞ | `https://mysite.com/landing` |

---

## üñ± 4. –ü–æ–≤–µ–¥–µ–Ω–∏–µ (–°–æ–±—ã—Ç–∏—è)
–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞ —Å–∞–π—Ç–µ.

### üëÅ –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`event_name: 'page_view'`)
| –î–∞–Ω–Ω—ã–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `page_url` | –ü–æ–ª–Ω—ã–π URL —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã |
| `data.page_title` | –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç—Ä–∞–Ω–∏—Ü—ã (`<title>`) |

### üëá –ö–ª–∏–∫ (`event_name: 'click'`)
| –î–∞–Ω–Ω—ã–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `data.text` | –¢–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ/—Å—Å—ã–ª–∫–µ |
| `data.href` | –ö—É–¥–∞ –≤–µ–¥–µ—Ç —Å—Å—ã–ª–∫–∞ |
| `data.class` | CSS –∫–ª–∞—Å—Å—ã —ç–ª–µ–º–µ–Ω—Ç–∞ (–¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –¥–∏–∑–∞–π–Ω–∞) |
| `data.id` | ID —ç–ª–µ–º–µ–Ω—Ç–∞ HTML |

### üìú –°–∫—Ä–æ–ª–ª (`event_name: 'scroll'`)
*–ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ*
| –î–∞–Ω–Ω—ã–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|:---|:---|
| `data.depth_pct` | –ì–ª—É–±–∏–Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ % (0-100) |
| `data.depth_px` | –ì–ª—É–±–∏–Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö |

---

## üìù 5. –õ–∏–¥—ã (–§–æ—Ä–º—ã)
–î–∞–Ω–Ω—ã–µ, –∫–æ–≥–¥–∞ —á–µ–ª–æ–≤–µ–∫ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –∑–∞—è–≤–∫—É.

### üì© –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã (`event_name: 'form_submit'`)
| –î–∞–Ω–Ω—ã–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|:---|:---|:---|
| `data.form_id` | ID —Ñ–æ—Ä–º—ã –≤ Tilda | `form123456789` |
| `data.form_data.email` | Email (–µ—Å–ª–∏ –µ—Å—Ç—å) | `client@mail.ru` |
| `data.form_data.phone` | –¢–µ–ª–µ—Ñ–æ–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å) | `+79001234567` |
| `data.form_data.name` | –ò–º—è (–µ—Å–ª–∏ –µ—Å—Ç—å) | `–ò–≤–∞–Ω` |

*(–°–∫—Ä–∏–ø—Ç –∏—â–µ—Ç –ø–æ–ª—è, —Å–æ–¥–µ—Ä–∂–∞—â–∏–µ 'email', 'phone', 'name' –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö)*

---

## üéØ 6. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### üî¥ –Ø–Ω–¥–µ–∫—Å.–ú–µ—Ç—Ä–∏–∫–∞ (`event_name: 'yandex_goal'`)
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç `ym(..., 'reachGoal', ...)`

| –î–∞–Ω–Ω—ã–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|:---|:---|:---|
| `data.goal_name` | –ù–∞–∑–≤–∞–Ω–∏–µ —Ü–µ–ª–∏ (–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä) | `purchase_succes` |
| `data.ym_id` | ID —Å—á–µ—Ç—á–∏–∫–∞ –ú–µ—Ç—Ä–∏–∫–∏ | `51854510` |
| `data.goal_params` | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–µ –≤ —Ü–µ–ª—å | `{order_price: 5000}` |

---

## üí° –ò—Ç–æ–≥–æ: –ö–∞–∫ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç –≤ –ë–î
–ü—Ä–∏–º–µ—Ä –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `analytics`:

```json
{
  "id": 105,
  "event_name": "click",
  "user_id": "550e8400-...", 
  "page_url": "https://mysite.com/catalog",
  "created_at": "2025-12-24T12:00:00Z",
  "data": {
    "text": "–ö—É–ø–∏—Ç—å",
    "class": "t-btn t-btn_md",
    "is_mobile": true,
    "utm_source": "yandex",
    "utm_medium": "cpc",
    "screen": "390x844",
    "page_title": "–ö–∞—Ç–∞–ª–æ–≥ —Ç–æ–≤–∞—Ä–æ–≤"
  }
}
```
